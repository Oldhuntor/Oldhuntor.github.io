<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Trading strategies based on Bayesian theory (Part 2) | Xuanhao&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="In the previous post we learned how to design trading strategies using the beta-binomial conjugate distribution. Can we design trading strategies using the gamma-Poisson conjugate distribution? This post will show an example of a trading strategy.
Model

Objective: simulate the average number of increases over a period of time
Prior distribution: gamma distribution, the following is the distribution function of gamma distribution:

$$ f(x; \alpha, \beta) = \frac{\beta^{\alpha} x^{\alpha - 1} e^{-\beta x}}{\Gamma(\alpha)}
$$
Below are the images of the gamma distribution function with different parameters:：

It can be seen that the domain of the gamma distribution is [0, &#43;$\infty$], which means that we can no longer choose to study the parameter $\theta$, which is a 0 to 1 probability of increase. We can study the average number of increases $\lambda$ over a period of time. This is why we need to choose the Poisson distribution to calculate the likelihood.">
<meta name="author" content="">
<link rel="canonical" href="https://oldhuntor.github.io/posts/poissongamma/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.947ec63dc116047c53b9829dd2110e5b357888ebd947138524e164bbb12c871f.css" integrity="sha256-lH7GPcEWBHxTuYKd0hEOWzV4iOvZRxOFJOFku7Eshx8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://oldhuntor.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://oldhuntor.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://oldhuntor.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://oldhuntor.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://oldhuntor.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://oldhuntor.github.io/posts/poissongamma/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://oldhuntor.github.io/posts/poissongamma/">
  <meta property="og:site_name" content="Xuanhao&#39;s Blog">
  <meta property="og:title" content="Trading strategies based on Bayesian theory (Part 2)">
  <meta property="og:description" content="In the previous post we learned how to design trading strategies using the beta-binomial conjugate distribution. Can we design trading strategies using the gamma-Poisson conjugate distribution? This post will show an example of a trading strategy.
Model Objective: simulate the average number of increases over a period of time Prior distribution: gamma distribution, the following is the distribution function of gamma distribution: $$ f(x; \alpha, \beta) = \frac{\beta^{\alpha} x^{\alpha - 1} e^{-\beta x}}{\Gamma(\alpha)} $$ Below are the images of the gamma distribution function with different parameters:： It can be seen that the domain of the gamma distribution is [0, &#43;$\infty$], which means that we can no longer choose to study the parameter $\theta$, which is a 0 to 1 probability of increase. We can study the average number of increases $\lambda$ over a period of time. This is why we need to choose the Poisson distribution to calculate the likelihood.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-12T19:12:16+01:00">
    <meta property="article:modified_time" content="2024-11-12T19:12:16+01:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Trading strategies based on Bayesian theory (Part 2)">
<meta name="twitter:description" content="In the previous post we learned how to design trading strategies using the beta-binomial conjugate distribution. Can we design trading strategies using the gamma-Poisson conjugate distribution? This post will show an example of a trading strategy.
Model

Objective: simulate the average number of increases over a period of time
Prior distribution: gamma distribution, the following is the distribution function of gamma distribution:

$$ f(x; \alpha, \beta) = \frac{\beta^{\alpha} x^{\alpha - 1} e^{-\beta x}}{\Gamma(\alpha)}
$$
Below are the images of the gamma distribution function with different parameters:：

It can be seen that the domain of the gamma distribution is [0, &#43;$\infty$], which means that we can no longer choose to study the parameter $\theta$, which is a 0 to 1 probability of increase. We can study the average number of increases $\lambda$ over a period of time. This is why we need to choose the Poisson distribution to calculate the likelihood.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://oldhuntor.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Trading strategies based on Bayesian theory (Part 2)",
      "item": "https://oldhuntor.github.io/posts/poissongamma/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Trading strategies based on Bayesian theory (Part 2)",
  "name": "Trading strategies based on Bayesian theory (Part 2)",
  "description": "In the previous post we learned how to design trading strategies using the beta-binomial conjugate distribution. Can we design trading strategies using the gamma-Poisson conjugate distribution? This post will show an example of a trading strategy.\nModel Objective: simulate the average number of increases over a period of time Prior distribution: gamma distribution, the following is the distribution function of gamma distribution: $$ f(x; \\alpha, \\beta) = \\frac{\\beta^{\\alpha} x^{\\alpha - 1} e^{-\\beta x}}{\\Gamma(\\alpha)} $$ Below are the images of the gamma distribution function with different parameters:： It can be seen that the domain of the gamma distribution is [0, +$\\infty$], which means that we can no longer choose to study the parameter $\\theta$, which is a 0 to 1 probability of increase. We can study the average number of increases $\\lambda$ over a period of time. This is why we need to choose the Poisson distribution to calculate the likelihood.\n",
  "keywords": [
    
  ],
  "articleBody": "In the previous post we learned how to design trading strategies using the beta-binomial conjugate distribution. Can we design trading strategies using the gamma-Poisson conjugate distribution? This post will show an example of a trading strategy.\nModel Objective: simulate the average number of increases over a period of time Prior distribution: gamma distribution, the following is the distribution function of gamma distribution: $$ f(x; \\alpha, \\beta) = \\frac{\\beta^{\\alpha} x^{\\alpha - 1} e^{-\\beta x}}{\\Gamma(\\alpha)} $$ Below are the images of the gamma distribution function with different parameters:： It can be seen that the domain of the gamma distribution is [0, +$\\infty$], which means that we can no longer choose to study the parameter $\\theta$, which is a 0 to 1 probability of increase. We can study the average number of increases $\\lambda$ over a period of time. This is why we need to choose the Poisson distribution to calculate the likelihood.\nPoisson distribution likelihood function: Poisson distribution has only one parameter $\\lambda$, which we define as the number of increases in a period of time. The following is the probability density function of Poisson distribution: $$L(\\lambda; k) = \\frac{e^{-\\lambda} \\lambda^k}{k!}$$ The following is the probability density image of Poisson distribution: It can be seen that the Poisson distribution is a discrete distribution, which can be used to simulate discrete values such as the number of increases. If we assume that the number of increases in each period of time is independent of each other, we can use the Poisson likelihood function. The following is the likelihood function of the Poisson distribution: $$L(\\lambda; x_1, x_2, \\ldots, x_n) = e^{-n\\lambda} \\lambda^{\\sum_{i=1}^{n}x_i} \\prod_{i=1}^{n} \\frac{1}{x_i!} $$ Posterior distribution After we have the prior distribution and likelihood function, we can calculate the posterior distribution, which is as follows: $$p(\\lambda | x_1, x_2, \\ldots, x_n; \\alpha', \\beta') = \\frac{{\\beta'}^{\\alpha'}}{\\Gamma(\\alpha')} \\lambda^{\\alpha' - 1} e^{-\\beta' \\lambda} $$ $$\\alpha' = \\alpha + \\sum_{i=1}^{n} x_i,\\beta' = \\beta + n$$ It can be found that the posterior distribution is also a gamma distribution, and the $\\alpha$ and $\\beta$ of the posterior distribution can be directly obtained through the information of the observed samples, which provides great convenience for the calculation. Application Examples Long cycle The long cycle determines the gamma distribution prior. The unit of the long cycle is hour k. The long cycle sequence is hour k of n days, which is synthesized by 7 * 24 * 60 = 10080 minute k. Then calculate the number of daily increases in 24 hours, {“day1”: 13, “day2”: 6, “day3”: 8….“dayn”: x} Calculate the sample mean and variance to estimate (Moment method, moment estimation) the prior alpha prior and beta prior $\\bar{x} = \\frac{\\alpha}{\\beta}$,$s^2 = \\frac{\\alpha}{\\beta^2}$\nShort cycle The short cycle determines the likelihood function. The unit of the short cycle is minute k. The length of the number cycle n may not be equal to that of the long cycle. The range of the number of short-term rises should preferably include the range of the number of long-term rises, that is, $\\lambda_{long} \\subseteq \\lambda_{short}$, because if the maximum number of short-term rises is 3 and the maximum number of long-term rises is 12, the posterior probability distribution will definitely move toward a smaller $\\lambda$ value, which will cause us to lose some information. So we assume that the maximum number of rises per cycle in such a short cycle is 24, that is, I need n 24 minute k, a total of n * 24 minute K lines. Get the short-term data {“k1”: 13, “k2”: 12, “k3”:9 , …..“kn”:x}\nCode simulation and implementation First, I randomly select 50 samples according to the number of increases range [0,24], and then calculate the mean and variance of this sample.\nlong_period_data = np.random.randint(0, 25, 50) # 假设每天的最大上涨次数为24 # Calculate mean and variance mean_long = np.mean(long_period_data) variance_long = np.var(long_period_data) # Estimate prior parameters of the gamma distribution alpha_prior = mean_long**2 / variance_long beta_prior = mean_long / variance_long Finally, the prior $\\alpha$ and $\\beta$ values are calculated using moment estimation. The next step is to simulate short-term data, also using random function sampling.\n#Simulate short-term (24-minute) data short_period_data = np.random.randint(0, 25, size=5) # 假设每24分钟周期的最大上涨次数为24 # Update the posterior distribution parameters alpha_posterior = alpha_prior + sum(short_period_data) beta_posterior = beta_prior + len(short_period_data) Finally, the posterior parameters are calculated according to the formula of the conjugate posterior distribution mentioned above. The following is an image comparison: It can be seen that the mean and mode of the posterior distribution have moved to the right, indicating that the average number of increases observed in the short period may be relatively high, causing the distribution to move to the right. Comparison of prior and posterior parameters:\nAlpha Prior: 1.7518570171605738, Beta Prior: 0.16190915130874067 Alpha Posterior: 77.75185701716057, Beta Posterior: 5.16190915130874 Case complete code:\nimport numpy as np from scipy.stats import gamma, poisson import matplotlib.pyplot as plt for i in range(5): #Simulate long-term data long_period_data = np.random.randint(0, 25, 50) # Assume that the maximum number of daily increases is 24 # Calculate mean and variance mean_long = np.mean(long_period_data) variance_long = np.var(long_period_data) # Estimate the prior parameters of the gamma distribution alpha_prior = mean_long**2 / variance_long beta_prior = mean_long / variance_long #Simulate short-term data short_period_data = np.random.randint(0, 25, size=5) # Assume that the maximum number of increases per 24-minute period is 24 # Update the posterior distribution parameters alpha_posterior = alpha_prior + sum(short_period_data) beta_posterior = beta_prior + len(short_period_data) # Output results print(f\"Alpha Prior: {alpha_prior}, Beta Prior: {beta_prior}\") print(f\"Alpha Posterior: {alpha_posterior}, Beta Posterior: {beta_posterior}\") # Create prior and posterior distributions for the gamma distribution prior_dist = gamma(alpha_prior, scale = 1/beta_prior) posterior_dist = gamma(alpha_posterior, scale = 1/beta_posterior) lambda_samples = np.random.gamma(alpha_posterior, 1/beta_posterior, 1000) # Generate gamma distribution probability density function (PDF) data x = np.linspace(0, 50, 100000) y_prior = prior_dist.pdf(x) y_posterior = posterior_dist.pdf(x) # Draw the image plt.figure(figsize=(10, 6)) plt.plot(x, y_prior, label='Prior Distribution') plt.plot(x, y_posterior, label='Posterior Distribution') plt.title('Gamma Distribution: Prior vs Posterior') plt.xlabel('lambda') plt.ylabel('Density') plt.legend() plt.show() Strategy Backtesting Strategy Logic Logic 1: After obtaining the parameters of the posterior distribution, calculate the posterior mode: $$\\alpha_{mode} = \\frac{\\alpha_{post}-1}{\\beta_{post}} $$ Use this posterior mode as an estimate of the number of rises in the next short period. If $\\frac{\\alpha_{mode}}{n}\u003e$buy_threshold, it is considered a long signal, otherwise if it is less than sell_threshold, it is considered a short signal. Logic 2: Use the posterior prediction distribution to calculate the posterior probability of the target number of increases: $$ p(\\lambda_{\\text{new}} | D) = \\int p(\\lambda_{\\text{new}} | \\theta) p(\\theta | D) d\\theta $$ First, the target number of increases $\\lambda_{new}$ is generally a number greater than $\\frac{n}2$ (because we hope that the number of increases in the next period will be more). Similarly, if this probability is greater than buy_threshold, it is a long signal, otherwise if it is less than sell_threshold, it is a short signal. The following is the python code for this formula:\n# Simulate calculus lambda_space = np.linspace(0,30,1000) delta_lambda = lambda_space[1] - lambda_space[0] prob_post = np.sum(poisson.pmf(target_lambda, lambda_space) * gamma.pdf(lambda_space, a=alpha_posterior, scale=1/beta_posterior)) * delta_lambda Assuming $\\lambda_{new}=15$, we can also calculate the probability that the number of increases is greater than 15, that is, the probability of $P(\\lambda_{new}\u003e15)$, that is, add up all the probabilities greater than the target value:\npost_prop = [] for x_new in np.arange(target_lambda,n,1): prob_new = np.sum(poisson.pmf(x_new, lambda_space) * gamma.pdf(lambda_space, a=alpha_posterior, scale=1 / beta_posterior)) * delta_lambda post_prop.append(prob_new) post_prop = sum(post_prop) In actual combat, you can choose different trading logics according to your needs.\nStrategy parameters dual_side: whether to open a position in both directions pyramiding: maximum number of openings in the same direction long_trend_window_size: long period sequence length short_trend_window_size: short period sequence length long_trend_period: long period granularity, short_trend_period: short period granularity buy_threshold: long threshold sell_threshold: short threshold fix_size: the amount of each opening frequency: the range of the number of increases long_trend_interval：m （m分钟，h小时，d日） short_trend_interval：m Default parameters: Target: BTCUSD Start date: 2022-1-1 End date: 2023-12-6 Fee rate: 0.002 Funds: 100000\nBacktest results Strategy curve Summary The Bayesian trading strategy using the gamma-poisson conjugate is very flexible. I only show the backtest results of method 1 in the strategy logic. Readers can also build strategies based on the number of times, rather than converting to probability like me. For example, if the number of posterior increases is 15, can I block the reversal market after 15 increases? Everyone is welcome to discuss.\nStrategy code from vnpy_ctastrategy import ( CtaTemplate, StopOrder, TickData, BarData, TradeData, OrderData, BarGenerator, ArrayManager, ) import numpy as np from vnpy.trader.object import Interval from scipy.stats import gamma, poisson interval_map = {\"m\": Interval.MINUTE, \"h\": Interval.HOUR, \"d\": Interval.DAILY} class PoissonGammaStrategy(CtaTemplate): author = \"Xuanhao\" prior = 0 pyramiding = 1 frequency = 24 long_trend_window_size = 5 short_trend_window_size = 5 long_trend_period = 1 # 1hour 2hour short_trend_period = 5 # 5 minutes long_trend_interval = \"m\" short_trend_interval = \"m\" fix_size = 1 buy_threshold = 0.55 sell_threshold = 0.45 dual_side = 1 parameters = [\"dual_side\", \"pyramiding\", \"long_trend_window_size\",\"short_trend_window_size\",\"long_trend_period\", \"short_trend_period\" ,\"fix_size\", \"buy_threshold\", \"sell_threshold\", \"frequency\", \"long_trend_interval\", \"short_trend_interval\"] variables = [\"bayesian_prob\"] def __init__(self, cta_engine, strategy_name, vt_symbol, setting): super().__init__(cta_engine, strategy_name, vt_symbol, setting) long_interval = interval_map[self.long_trend_interval] short_interval = interval_map[self.short_trend_interval] self.bg_long = BarGenerator(self.on_bar, self.long_trend_period, self.on_long_bar, interval=long_interval) self.bg_short = BarGenerator(self.on_bar, self.short_trend_period, self.on_short_bar, interval=short_interval) self.am_long = ArrayManager(self.long_trend_window_size*self.frequency) self.am_short = ArrayManager(self.short_trend_window_size*self.frequency) self.priors_inited = False def on_init(self): self.write_log(\"策略初始化\") self.load_bar(10) def on_start(self): self.write_log(\"策略启动\") self.put_event() def on_stop(self): self.write_log(\"策略停止\") self.put_event() def on_bar(self, bar: BarData): self.bg_long.update_bar(bar) self.bg_short.update_bar(bar) def on_long_bar(self, long_bar: BarData): self.am_long.update_bar(long_bar) if not self.am_long.inited: return poisson_event = [] for order in range(self.long_trend_window_size): ups = sum(1 for index in np.arange((order)*self.frequency, (order+1)*self.frequency, 1) if self.am_long.close_array[index] \u003e self.am_long.open_array[index]) poisson_event.append(ups) mean = np.mean(poisson_event) variance = np.var(poisson_event) ## MM estimator self.alpha_prior = mean ** 2 / variance self.beta_prior = mean / variance self.priors_inited = True def on_short_bar(self, short_bar: BarData): self.am_short.update_bar(short_bar) if not self.am_short.inited: return if not self.priors_inited: return poisson_event = [] for order in range(self.short_trend_window_size): ups = sum(1 for index in np.arange((order) * self.frequency, (order + 1) * self.frequency, 1) if self.am_short.close_array[index] \u003e self.am_short.open_array[index]) poisson_event.append(ups) self.alpha_post = self.alpha_prior + sum(poisson_event) self.beta_post = self.beta_prior + self.short_trend_window_size # use posterior mean or mode self.poster_mean = self.alpha_post/self.beta_post self.poster_var = self.alpha_post/(self.beta_post)**2 self.poster_mode = (self.alpha_post-1)/self.beta_post if self.dual_side: # both long and short if self.poster_mode/self.short_trend_window_size \u003e self.buy_threshold: if self.pos \u003e= 0: if abs(self.pos) \u003c self.pyramiding: self.buy(short_bar.close_price, self.fix_size) else: self.cover(short_bar.close_price, abs(self.pos)) self.buy(short_bar.close_price, self.fix_size) if self.poster_mode/self.short_trend_window_size \u003c self.sell_threshold: if self.pos \u003c= 0: if abs(self.pos) \u003c self.pyramiding: self.short(short_bar.close_price, self.fix_size) else: self.sell(short_bar.close_price, abs(self.pos)) self.short(short_bar.close_price, self.fix_size) else: if self.poster_mode/self.short_trend_window_size \u003e self.buy_threshold: if self.pos \u003e= 0 and self.pos \u003c self.pyramiding: self.buy(short_bar.close_price, self.fix_size) if self.poster_mode/self.short_trend_window_size \u003c self.sell_threshold: if self.pos != 0: self.sell(short_bar.close_price, self.pos) ",
  "wordCount" : "1716",
  "inLanguage": "en",
  "datePublished": "2024-11-12T19:12:16+01:00",
  "dateModified": "2024-11-12T19:12:16+01:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://oldhuntor.github.io/posts/poissongamma/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xuanhao's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://oldhuntor.github.io/favicon.ico"
    }
  }
}
</script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.13/katex.min.css">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.13/katex.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.13/contrib/auto-render.min.js"
            onload="renderMathInElement(document.body);"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
          ]
        });
      });
    </script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://oldhuntor.github.io/" accesskey="h" title="Xuanhao&#39;s Blog (Alt + H)">Xuanhao&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://oldhuntor.github.io/posts/about-me" title="About Me">
                    <span>About Me</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Trading strategies based on Bayesian theory (Part 2)
    </h1>
    <div class="post-meta"><span title='2024-11-12 19:12:16 +0100 CET'>November 12, 2024</span>&nbsp;·&nbsp;9 min

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#model" aria-label="Model">Model</a></li>
                <li>
                    <a href="#application-examples" aria-label="Application Examples">Application Examples</a><ul>
                        <ul>
                        
                <li>
                    <a href="#code-simulation-and-implementation" aria-label="Code simulation and implementation">Code simulation and implementation</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#strategy-backtesting" aria-label="Strategy Backtesting">Strategy Backtesting</a><ul>
                        
                <li>
                    <a href="#strategy-logic" aria-label="Strategy Logic">Strategy Logic</a></li>
                <li>
                    <a href="#strategy-parameters" aria-label="Strategy parameters">Strategy parameters</a></li>
                <li>
                    <a href="#backtest-results" aria-label="Backtest results">Backtest results</a></li></ul>
                </li>
                <li>
                    <a href="#summary" aria-label="Summary">Summary</a></li>
                <li>
                    <a href="#strategy-code" aria-label="Strategy code">Strategy code</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><a href="/posts/betabinomial/">In the previous post</a> we learned how to design trading strategies using the beta-binomial conjugate distribution. Can we design trading strategies using the gamma-Poisson conjugate distribution? This post will show an example of a trading strategy.</p>
<h2 id="model">Model<a hidden class="anchor" aria-hidden="true" href="#model">#</a></h2>
<ul>
<li>Objective: simulate the average number of increases over a period of time</li>
<li>Prior distribution: gamma distribution, the following is the distribution function of gamma distribution:</li>
</ul>
$$ f(x; \alpha, \beta) = \frac{\beta^{\alpha} x^{\alpha - 1} e^{-\beta x}}{\Gamma(\alpha)}
$$<p>
Below are the images of the gamma distribution function with different parameters:：
<img alt="Alt text" loading="lazy" src="/images/poi_1.png">
It can be seen that the domain of the gamma distribution is [0, +$\infty$], which means that we can no longer choose to study the parameter $\theta$, which is a 0 to 1 probability of increase. We can study the average number of increases $\lambda$ over a period of time. This is why we need to choose the Poisson distribution to calculate the likelihood.</p>
<ul>
<li>Poisson distribution likelihood function:
Poisson distribution has only one parameter $\lambda$, which we define as the number of increases in a period of time.
The following is the probability density function of Poisson distribution:
$$L(\lambda; k) = \frac{e^{-\lambda} \lambda^k}{k!}$$
The following is the probability density image of Poisson distribution:
<img alt="Alt text" loading="lazy" src="/images/poi_2.png">
It can be seen that the Poisson distribution is a discrete distribution, which can be used to simulate discrete values such as the number of increases.
If we assume that the number of increases in each period of time is independent of each other, we can use the Poisson likelihood function.
The following is the likelihood function of the Poisson distribution:
$$L(\lambda; x_1, x_2, \ldots, x_n) = e^{-n\lambda} \lambda^{\sum_{i=1}^{n}x_i} \prod_{i=1}^{n} \frac{1}{x_i!} $$</li>
<li>Posterior distribution
After we have the prior distribution and likelihood function, we can calculate the posterior distribution, which is as follows:
$$p(\lambda | x_1, x_2, \ldots, x_n; \alpha', \beta') = \frac{{\beta'}^{\alpha'}}{\Gamma(\alpha')} \lambda^{\alpha' - 1} e^{-\beta' \lambda} $$
$$\alpha' = \alpha + \sum_{i=1}^{n} x_i,\beta' = \beta + n$$
It can be found that the posterior distribution is also a gamma distribution, and the $\alpha$ and $\beta$ of the posterior distribution can be directly obtained through the information of the observed samples, which provides great convenience for the calculation.</li>
</ul>
<h2 id="application-examples">Application Examples<a hidden class="anchor" aria-hidden="true" href="#application-examples">#</a></h2>
<ol>
<li>
<p>Long cycle
The long cycle determines the gamma distribution prior.
The unit of the long cycle is hour k.
The long cycle sequence is hour k of n days, which is synthesized by 7 * 24 * 60 = 10080 minute k.
Then calculate the number of daily increases in 24 hours, {&ldquo;day1&rdquo;: 13, &ldquo;day2&rdquo;: 6, &ldquo;day3&rdquo;: 8&hellip;.&ldquo;dayn&rdquo;: x}
Calculate the sample mean and variance to estimate (Moment method, moment estimation) the prior alpha prior and beta prior
$\bar{x} = \frac{\alpha}{\beta}$,$s^2 = \frac{\alpha}{\beta^2}$</p>
</li>
<li>
<p>Short cycle
The short cycle determines the likelihood function.
The unit of the short cycle is minute k.
The length of the number cycle n may not be equal to that of the long cycle.
The range of the number of short-term rises should preferably include the range of the number of long-term rises, that is, $\lambda_{long} \subseteq \lambda_{short}$, because if the maximum number of short-term rises is 3 and the maximum number of long-term rises is 12, the posterior probability distribution will definitely move toward a smaller $\lambda$ value, which will cause us to lose some information.
So we assume that the maximum number of rises per cycle in such a short cycle is 24, that is, I need n 24 minute k, a total of n * 24 minute K lines.
Get the short-term data {&ldquo;k1&rdquo;: 13, &ldquo;k2&rdquo;: 12, &ldquo;k3&rdquo;:9 , &hellip;..&ldquo;kn&rdquo;:x}</p>
</li>
</ol>
<h4 id="code-simulation-and-implementation">Code simulation and implementation<a hidden class="anchor" aria-hidden="true" href="#code-simulation-and-implementation">#</a></h4>
<p>First, I randomly select 50 samples according to the number of increases range [0,24], and then calculate the mean and variance of this sample.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>long_period_data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">50</span>)  <span style="color:#75715e"># 假设每天的最大上涨次数为24</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate mean and variance</span>
</span></span><span style="display:flex;"><span>mean_long <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(long_period_data)
</span></span><span style="display:flex;"><span>variance_long <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>var(long_period_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Estimate prior parameters of the gamma distribution</span>
</span></span><span style="display:flex;"><span>alpha_prior <span style="color:#f92672">=</span> mean_long<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> variance_long
</span></span><span style="display:flex;"><span>beta_prior <span style="color:#f92672">=</span> mean_long <span style="color:#f92672">/</span> variance_long
</span></span></code></pre></div><p>Finally, the prior $\alpha$ and $\beta$ values are calculated using moment estimation. The next step is to simulate short-term data, also using random function sampling.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#Simulate short-term (24-minute) data</span>
</span></span><span style="display:flex;"><span>    short_period_data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)  <span style="color:#75715e"># 假设每24分钟周期的最大上涨次数为24</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update the posterior distribution parameters    </span>
</span></span><span style="display:flex;"><span>    alpha_posterior <span style="color:#f92672">=</span> alpha_prior <span style="color:#f92672">+</span> sum(short_period_data)
</span></span><span style="display:flex;"><span>    beta_posterior <span style="color:#f92672">=</span> beta_prior <span style="color:#f92672">+</span> len(short_period_data)
</span></span></code></pre></div><p>Finally, the posterior parameters are calculated according to the formula of the conjugate posterior distribution mentioned above.
The following is an image comparison:
<img alt="Alt text" loading="lazy" src="/images/poi_3.png">
It can be seen that the mean and mode of the posterior distribution have moved to the right, indicating that the average number of increases observed in the short period may be relatively high, causing the distribution to move to the right.
Comparison of prior and posterior parameters:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Alpha Prior: <span style="color:#ae81ff">1.7518570171605738</span>, Beta Prior: <span style="color:#ae81ff">0.16190915130874067</span>
</span></span><span style="display:flex;"><span>Alpha Posterior: <span style="color:#ae81ff">77.75185701716057</span>, Beta Posterior: <span style="color:#ae81ff">5.16190915130874</span>
</span></span></code></pre></div><p>Case complete code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> gamma, poisson
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#Simulate long-term data</span>
</span></span><span style="display:flex;"><span>    long_period_data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">50</span>) <span style="color:#75715e"># Assume that the maximum number of daily increases is 24</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># Calculate mean and variance</span>
</span></span><span style="display:flex;"><span>    mean_long <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(long_period_data)
</span></span><span style="display:flex;"><span>    variance_long <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>var(long_period_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Estimate the prior parameters of the gamma distribution</span>
</span></span><span style="display:flex;"><span>    alpha_prior <span style="color:#f92672">=</span> mean_long<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> variance_long
</span></span><span style="display:flex;"><span>    beta_prior <span style="color:#f92672">=</span> mean_long <span style="color:#f92672">/</span> variance_long
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">#Simulate short-term data</span>
</span></span><span style="display:flex;"><span>    short_period_data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)  <span style="color:#75715e"># Assume that the maximum number of increases per 24-minute period is 24</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Update the posterior distribution parameters</span>
</span></span><span style="display:flex;"><span>    alpha_posterior <span style="color:#f92672">=</span> alpha_prior <span style="color:#f92672">+</span> sum(short_period_data)
</span></span><span style="display:flex;"><span>    beta_posterior <span style="color:#f92672">=</span> beta_prior <span style="color:#f92672">+</span> len(short_period_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Output results</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Alpha Prior: </span><span style="color:#e6db74">{</span>alpha_prior<span style="color:#e6db74">}</span><span style="color:#e6db74">, Beta Prior: </span><span style="color:#e6db74">{</span>beta_prior<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Alpha Posterior: </span><span style="color:#e6db74">{</span>alpha_posterior<span style="color:#e6db74">}</span><span style="color:#e6db74">, Beta Posterior: </span><span style="color:#e6db74">{</span>beta_posterior<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create prior and posterior distributions for the gamma distribution</span>
</span></span><span style="display:flex;"><span>    prior_dist <span style="color:#f92672">=</span> gamma(alpha_prior, scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>beta_prior)
</span></span><span style="display:flex;"><span>    posterior_dist <span style="color:#f92672">=</span> gamma(alpha_posterior, scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>beta_posterior)
</span></span><span style="display:flex;"><span>    lambda_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>gamma(alpha_posterior, <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>beta_posterior, <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Generate gamma distribution probability density function (PDF) data</span>
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">100000</span>)
</span></span><span style="display:flex;"><span>    y_prior <span style="color:#f92672">=</span> prior_dist<span style="color:#f92672">.</span>pdf(x)
</span></span><span style="display:flex;"><span>    y_posterior <span style="color:#f92672">=</span> posterior_dist<span style="color:#f92672">.</span>pdf(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Draw the image</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(x, y_prior, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Prior Distribution&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(x, y_posterior, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Posterior Distribution&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Gamma Distribution: Prior vs Posterior&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;lambda&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Density&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><h2 id="strategy-backtesting">Strategy Backtesting<a hidden class="anchor" aria-hidden="true" href="#strategy-backtesting">#</a></h2>
<h3 id="strategy-logic">Strategy Logic<a hidden class="anchor" aria-hidden="true" href="#strategy-logic">#</a></h3>
<p>Logic 1:
After obtaining the parameters of the posterior distribution, calculate the posterior mode:
</p>
$$\alpha_{mode} = \frac{\alpha_{post}-1}{\beta_{post}} $$<p>
Use this posterior mode as an estimate of the number of rises in the next short period.
If $\frac{\alpha_{mode}}{n}&gt;$buy_threshold, it is considered a long signal, otherwise if it is less than sell_threshold, it is considered a short signal.
Logic 2:
Use the posterior prediction distribution to calculate the posterior probability of the target number of increases:
</p>
$$
p(\lambda_{\text{new}} | D) = \int p(\lambda_{\text{new}} | \theta) p(\theta | D) d\theta
$$<p>
First, the target number of increases $\lambda_{new}$ is generally a number greater than $\frac{n}2$ (because we hope that the number of increases in the next period will be more). Similarly, if this probability is greater than buy_threshold, it is a long signal, otherwise if it is less than sell_threshold, it is a short signal.
The following is the python code for this formula:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Simulate calculus</span>
</span></span><span style="display:flex;"><span>lambda_space <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">30</span>,<span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>delta_lambda <span style="color:#f92672">=</span> lambda_space[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> lambda_space[<span style="color:#ae81ff">0</span>]  
</span></span><span style="display:flex;"><span>prob_post <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sum(poisson<span style="color:#f92672">.</span>pmf(target_lambda, lambda_space) <span style="color:#f92672">*</span> gamma<span style="color:#f92672">.</span>pdf(lambda_space, a<span style="color:#f92672">=</span>alpha_posterior, scale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>beta_posterior)) <span style="color:#f92672">*</span> delta_lambda
</span></span></code></pre></div><p>Assuming $\lambda_{new}=15$, we can also calculate the probability that the number of increases is greater than 15, that is, the probability of $P(\lambda_{new}&gt;15)$, that is, add up all the probabilities greater than the target value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>post_prop <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> x_new <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>arange(target_lambda,n,<span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    prob_new <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sum(poisson<span style="color:#f92672">.</span>pmf(x_new, lambda_space) <span style="color:#f92672">*</span> gamma<span style="color:#f92672">.</span>pdf(lambda_space, a<span style="color:#f92672">=</span>alpha_posterior,
</span></span><span style="display:flex;"><span>                                                                  scale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> beta_posterior)) <span style="color:#f92672">*</span> delta_lambda
</span></span><span style="display:flex;"><span>    post_prop<span style="color:#f92672">.</span>append(prob_new)
</span></span><span style="display:flex;"><span>post_prop <span style="color:#f92672">=</span> sum(post_prop)
</span></span></code></pre></div><p>In actual combat, you can choose different trading logics according to your needs.</p>
<h3 id="strategy-parameters">Strategy parameters<a hidden class="anchor" aria-hidden="true" href="#strategy-parameters">#</a></h3>
<ul>
<li>dual_side: whether to open a position in both directions</li>
<li>pyramiding: maximum number of openings in the same direction</li>
<li>long_trend_window_size: long period sequence length</li>
<li>short_trend_window_size: short period sequence length</li>
<li>long_trend_period: long period granularity,</li>
<li>short_trend_period: short period granularity</li>
<li>buy_threshold: long threshold</li>
<li>sell_threshold: short threshold</li>
<li>fix_size: the amount of each opening</li>
<li>frequency: the range of the number of increases</li>
<li>long_trend_interval：m （m分钟，h小时，d日）</li>
<li>short_trend_interval：m</li>
</ul>
<p>Default parameters:
<img alt="Alt text" loading="lazy" src="/images/poi_4.png"></p>
<p>Target: BTCUSD
Start date: 2022-1-1
End date: 2023-12-6
Fee rate: 0.002
Funds: 100000</p>
<h3 id="backtest-results">Backtest results<a hidden class="anchor" aria-hidden="true" href="#backtest-results">#</a></h3>
<p><img alt="Alt text" loading="lazy" src="/images/poi_5.jpg"></p>
<p><img alt="Alt text" loading="lazy" src="/images/poi_6.jpg"></p>
<ul>
<li>Strategy curve
<img alt="Alt text" loading="lazy" src="/images/poi_7.png"></li>
</ul>
<h2 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<p>The Bayesian trading strategy using the gamma-poisson conjugate is very flexible. I only show the backtest results of method 1 in the strategy logic. Readers can also build strategies based on the number of times, rather than converting to probability like me. For example, if the number of posterior increases is 15, can I block the reversal market after 15 increases? Everyone is welcome to discuss.</p>
<h2 id="strategy-code">Strategy code<a hidden class="anchor" aria-hidden="true" href="#strategy-code">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> vnpy_ctastrategy <span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    CtaTemplate,
</span></span><span style="display:flex;"><span>    StopOrder,
</span></span><span style="display:flex;"><span>    TickData,
</span></span><span style="display:flex;"><span>    BarData,
</span></span><span style="display:flex;"><span>    TradeData,
</span></span><span style="display:flex;"><span>    OrderData,
</span></span><span style="display:flex;"><span>    BarGenerator,
</span></span><span style="display:flex;"><span>    ArrayManager,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> vnpy.trader.object <span style="color:#f92672">import</span> Interval
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> gamma, poisson
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>interval_map <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;m&#34;</span>: Interval<span style="color:#f92672">.</span>MINUTE,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;h&#34;</span>: Interval<span style="color:#f92672">.</span>HOUR,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;d&#34;</span>: Interval<span style="color:#f92672">.</span>DAILY}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PoissonGammaStrategy</span>(CtaTemplate):
</span></span><span style="display:flex;"><span>    author <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Xuanhao&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    prior <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    pyramiding <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    frequency <span style="color:#f92672">=</span> <span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>    long_trend_window_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    short_trend_window_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    long_trend_period <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># 1hour 2hour</span>
</span></span><span style="display:flex;"><span>    short_trend_period <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span> <span style="color:#75715e"># 5 minutes</span>
</span></span><span style="display:flex;"><span>    long_trend_interval <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m&#34;</span>
</span></span><span style="display:flex;"><span>    short_trend_interval <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m&#34;</span>
</span></span><span style="display:flex;"><span>    fix_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    buy_threshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.55</span>
</span></span><span style="display:flex;"><span>    sell_threshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.45</span>
</span></span><span style="display:flex;"><span>    dual_side <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    parameters <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;dual_side&#34;</span>, <span style="color:#e6db74">&#34;pyramiding&#34;</span>, <span style="color:#e6db74">&#34;long_trend_window_size&#34;</span>,<span style="color:#e6db74">&#34;short_trend_window_size&#34;</span>,<span style="color:#e6db74">&#34;long_trend_period&#34;</span>, <span style="color:#e6db74">&#34;short_trend_period&#34;</span> ,<span style="color:#e6db74">&#34;fix_size&#34;</span>, <span style="color:#e6db74">&#34;buy_threshold&#34;</span>, <span style="color:#e6db74">&#34;sell_threshold&#34;</span>, <span style="color:#e6db74">&#34;frequency&#34;</span>, <span style="color:#e6db74">&#34;long_trend_interval&#34;</span>, <span style="color:#e6db74">&#34;short_trend_interval&#34;</span>]
</span></span><span style="display:flex;"><span>    variables <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;bayesian_prob&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, cta_engine, strategy_name, vt_symbol, setting):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span>__init__(cta_engine, strategy_name, vt_symbol, setting)
</span></span><span style="display:flex;"><span>        long_interval <span style="color:#f92672">=</span> interval_map[self<span style="color:#f92672">.</span>long_trend_interval]
</span></span><span style="display:flex;"><span>        short_interval <span style="color:#f92672">=</span> interval_map[self<span style="color:#f92672">.</span>short_trend_interval]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bg_long <span style="color:#f92672">=</span> BarGenerator(self<span style="color:#f92672">.</span>on_bar, self<span style="color:#f92672">.</span>long_trend_period, self<span style="color:#f92672">.</span>on_long_bar, interval<span style="color:#f92672">=</span>long_interval)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bg_short <span style="color:#f92672">=</span> BarGenerator(self<span style="color:#f92672">.</span>on_bar, self<span style="color:#f92672">.</span>short_trend_period, self<span style="color:#f92672">.</span>on_short_bar, interval<span style="color:#f92672">=</span>short_interval)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>am_long <span style="color:#f92672">=</span> ArrayManager(self<span style="color:#f92672">.</span>long_trend_window_size<span style="color:#f92672">*</span>self<span style="color:#f92672">.</span>frequency)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>am_short <span style="color:#f92672">=</span> ArrayManager(self<span style="color:#f92672">.</span>short_trend_window_size<span style="color:#f92672">*</span>self<span style="color:#f92672">.</span>frequency)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>priors_inited <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_init</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>write_log(<span style="color:#e6db74">&#34;策略初始化&#34;</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>load_bar(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_start</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>write_log(<span style="color:#e6db74">&#34;策略启动&#34;</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>put_event()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_stop</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>write_log(<span style="color:#e6db74">&#34;策略停止&#34;</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>put_event()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_bar</span>(self, bar: BarData):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bg_long<span style="color:#f92672">.</span>update_bar(bar)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bg_short<span style="color:#f92672">.</span>update_bar(bar)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_long_bar</span>(self, long_bar: BarData):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>am_long<span style="color:#f92672">.</span>update_bar(long_bar)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>am_long<span style="color:#f92672">.</span>inited:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>        poisson_event <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> order <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>long_trend_window_size):
</span></span><span style="display:flex;"><span>            ups <span style="color:#f92672">=</span> sum(<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> index <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>arange((order)<span style="color:#f92672">*</span>self<span style="color:#f92672">.</span>frequency, (order<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>self<span style="color:#f92672">.</span>frequency, <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">if</span>
</span></span><span style="display:flex;"><span>                      self<span style="color:#f92672">.</span>am_long<span style="color:#f92672">.</span>close_array[index] <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>am_long<span style="color:#f92672">.</span>open_array[index])
</span></span><span style="display:flex;"><span>            poisson_event<span style="color:#f92672">.</span>append(ups)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        mean <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(poisson_event)
</span></span><span style="display:flex;"><span>        variance <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>var(poisson_event)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">## MM estimator</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>alpha_prior <span style="color:#f92672">=</span> mean <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> variance
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>beta_prior <span style="color:#f92672">=</span> mean <span style="color:#f92672">/</span> variance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>priors_inited <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_short_bar</span>(self, short_bar: BarData):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>am_short<span style="color:#f92672">.</span>update_bar(short_bar)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>am_short<span style="color:#f92672">.</span>inited:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>priors_inited:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        poisson_event <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> order <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>short_trend_window_size):
</span></span><span style="display:flex;"><span>            ups <span style="color:#f92672">=</span> sum(<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> index <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>arange((order) <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>frequency, (order <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>frequency, <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">if</span>
</span></span><span style="display:flex;"><span>                      self<span style="color:#f92672">.</span>am_short<span style="color:#f92672">.</span>close_array[index] <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>am_short<span style="color:#f92672">.</span>open_array[index])
</span></span><span style="display:flex;"><span>            poisson_event<span style="color:#f92672">.</span>append(ups)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>alpha_post <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>alpha_prior <span style="color:#f92672">+</span> sum(poisson_event)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>beta_post <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>beta_prior <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>short_trend_window_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># use posterior mean or mode</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>poster_mean <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>alpha_post<span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>beta_post
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>poster_var <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>alpha_post<span style="color:#f92672">/</span>(self<span style="color:#f92672">.</span>beta_post)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>poster_mode <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>alpha_post<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>beta_post
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>dual_side:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># both long and short</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>poster_mode<span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>short_trend_window_size <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>buy_threshold:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>pos <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> abs(self<span style="color:#f92672">.</span>pos) <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>pyramiding:
</span></span><span style="display:flex;"><span>                        self<span style="color:#f92672">.</span>buy(short_bar<span style="color:#f92672">.</span>close_price, self<span style="color:#f92672">.</span>fix_size)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>cover(short_bar<span style="color:#f92672">.</span>close_price, abs(self<span style="color:#f92672">.</span>pos))
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>buy(short_bar<span style="color:#f92672">.</span>close_price, self<span style="color:#f92672">.</span>fix_size)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>poster_mode<span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>short_trend_window_size <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>sell_threshold:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>pos <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> abs(self<span style="color:#f92672">.</span>pos) <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>pyramiding:
</span></span><span style="display:flex;"><span>                        self<span style="color:#f92672">.</span>short(short_bar<span style="color:#f92672">.</span>close_price, self<span style="color:#f92672">.</span>fix_size)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>sell(short_bar<span style="color:#f92672">.</span>close_price, abs(self<span style="color:#f92672">.</span>pos))
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>short(short_bar<span style="color:#f92672">.</span>close_price, self<span style="color:#f92672">.</span>fix_size)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>poster_mode<span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>short_trend_window_size <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>buy_threshold:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>pos <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>pos <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>pyramiding:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>buy(short_bar<span style="color:#f92672">.</span>close_price, self<span style="color:#f92672">.</span>fix_size)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>poster_mode<span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>short_trend_window_size <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>sell_threshold:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>pos <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>sell(short_bar<span style="color:#f92672">.</span>close_price, self<span style="color:#f92672">.</span>pos)
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Trading strategies based on Bayesian theory (Part 2) on x"
            href="https://x.com/intent/tweet/?text=Trading%20strategies%20based%20on%20Bayesian%20theory%20%28Part%202%29&amp;url=https%3a%2f%2foldhuntor.github.io%2fposts%2fpoissongamma%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Trading strategies based on Bayesian theory (Part 2) on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2foldhuntor.github.io%2fposts%2fpoissongamma%2f&amp;title=Trading%20strategies%20based%20on%20Bayesian%20theory%20%28Part%202%29&amp;summary=Trading%20strategies%20based%20on%20Bayesian%20theory%20%28Part%202%29&amp;source=https%3a%2f%2foldhuntor.github.io%2fposts%2fpoissongamma%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Trading strategies based on Bayesian theory (Part 2) on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2foldhuntor.github.io%2fposts%2fpoissongamma%2f&title=Trading%20strategies%20based%20on%20Bayesian%20theory%20%28Part%202%29">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Trading strategies based on Bayesian theory (Part 2) on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2foldhuntor.github.io%2fposts%2fpoissongamma%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Trading strategies based on Bayesian theory (Part 2) on whatsapp"
            href="https://api.whatsapp.com/send?text=Trading%20strategies%20based%20on%20Bayesian%20theory%20%28Part%202%29%20-%20https%3a%2f%2foldhuntor.github.io%2fposts%2fpoissongamma%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Trading strategies based on Bayesian theory (Part 2) on telegram"
            href="https://telegram.me/share/url?text=Trading%20strategies%20based%20on%20Bayesian%20theory%20%28Part%202%29&amp;url=https%3a%2f%2foldhuntor.github.io%2fposts%2fpoissongamma%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Trading strategies based on Bayesian theory (Part 2) on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Trading%20strategies%20based%20on%20Bayesian%20theory%20%28Part%202%29&u=https%3a%2f%2foldhuntor.github.io%2fposts%2fpoissongamma%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://oldhuntor.github.io/">Xuanhao&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
