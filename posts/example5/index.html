<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Cointegration Pairs Trading | Xuanhao&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="
bibliography:

bibfile.bib


::: titlepage
Bayesian Approach to Cointegration Pair Trading\
&mdash; Project Report &mdash;
Advanced Bayesian Data Analysis\
Xuanhao Huang\
2025-03-11
TU Dortmund University
:::
Introduction
Statistical arbitrage or hedging has already been known for a long time,
people usually tackle this trading strategy with models with strong
assumptions and generally have only a limited amount of asset pairs to
trade based on some macro or micro economics assumption.
Usually, we assume that the two assets that we selected have a
cointegrated relationship but it&rsquo;s simply too strong. Moreover,
traditional methods don&rsquo;t provide any uncertainty quantification which
is important in finance, since the investor has to know how trustworthy
the prediction is.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/example5/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/example5/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.13/katex.min.css">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.13/katex.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.13/contrib/auto-render.min.js"
            onload="renderMathInElement(document.body);"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
          ]
        });
      });
    </script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xuanhao&#39;s Blog (Alt + H)">Xuanhao&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/about-me" title="About Me">
                    <span>About Me</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Cointegration Pairs Trading
    </h1>
    <div class="post-meta"><span title='2025-03-10 19:12:16 +0100 CET'>March 10, 2025</span>&nbsp;·&nbsp;14 min

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a><ul>
                        
                <li>
                    <a href="#a-heuristic-example" aria-label="A heuristic example">A heuristic example</a></li>
                <li>
                    <a href="#model-requirements-model-requirements" aria-label="Model requirements {#Model requirements}">Model requirements {#Model requirements}</a></li></ul>
                </li>
                <li>
                    <a href="#model-choices" aria-label="Model choices">Model choices</a><ul>
                        
                <li>
                    <a href="#experiment-setup" aria-label="Experiment setup">Experiment setup</a></li>
                <li>
                    <a href="#bayesian-regression" aria-label="Bayesian regression">Bayesian regression</a><ul>
                        
                <li>
                    <a href="#recursive-prior" aria-label="Recursive prior">Recursive prior</a></li>
                <li>
                    <a href="#fixed-prior" aria-label="fixed prior">fixed prior</a></li>
                <li>
                    <a href="#simulation-result" aria-label="Simulation result">Simulation result</a></li></ul>
                </li>
                <li>
                    <a href="#bayesian-generalized-additive-model" aria-label="Bayesian generalized additive model">Bayesian generalized additive model</a></li>
                <li>
                    <a href="#composite-gaussian-process" aria-label="Composite Gaussian Process">Composite Gaussian Process</a></li>
                <li>
                    <a href="#bayesian-structural-time-series" aria-label="Bayesian structural time series">Bayesian structural time series</a></li>
                <li>
                    <a href="#model-fitting-budgets" aria-label="model fitting budgets">model fitting budgets</a></li></ul>
                </li>
                <li>
                    <a href="#experiment" aria-label="Experiment">Experiment</a><ul>
                        
                <li>
                    <a href="#finding-cointegrated-pairs" aria-label="Finding cointegrated pairs">Finding cointegrated pairs</a></li>
                <li>
                    <a href="#real-world-data-experiments" aria-label="Real world data experiments">Real world data experiments</a></li></ul>
                </li>
                <li>
                    <a href="#future-works" aria-label="future works">future works</a></li>
                <li>
                    <a href="#appendix" aria-label="appendix">appendix</a><ul>
                        
                <li>
                    <a href="#clustering-result" aria-label="Clustering result">Clustering result</a></li>
                <li>
                    <a href="#backtesting-result" aria-label="Backtesting result">Backtesting result</a><ul>
                        
                <li>
                    <a href="#trading-strategy-flow-chart-and-the-backtest-framework" aria-label="Trading strategy flow chart and the backtest framework">Trading strategy flow chart and the backtest framework</a></li></ul>
                </li>
                <li>
                    <a href="#regime-changed-detection" aria-label="Regime changed detection">Regime changed detection</a></li>
                <li>
                    <a href="#code" aria-label="code">code</a></li>
                <li>
                    <a href="#acknowledgement" aria-label="Acknowledgement">Acknowledgement</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><hr>
<p>bibliography:</p>
<ul>
<li>bibfile.bib</li>
</ul>
<hr>
<p>::: titlepage
Bayesian Approach to Cointegration Pair Trading\</p>
<p>&mdash; Project Report &mdash;<br>
Advanced Bayesian Data Analysis\</p>
<p>Xuanhao Huang\</p>
<p>2025-03-11</p>
<p><em>TU Dortmund University</em>
:::</p>
<h1 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h1>
<p>Statistical arbitrage or hedging has already been known for a long time,
people usually tackle this trading strategy with models with strong
assumptions and generally have only a limited amount of asset pairs to
trade based on some macro or micro economics assumption.</p>
<p>Usually, we assume that the two assets that we selected have a
cointegrated relationship but it&rsquo;s simply too strong. Moreover,
traditional methods don&rsquo;t provide any uncertainty quantification which
is important in finance, since the investor has to know how trustworthy
the prediction is.</p>
<p>In this essay, we want to explore more modern and diverse statistical
methods for hedging, we will define a dynamic cointegrated relationship
and use Bayesian methods that provide us with uncertainty
quantification.</p>
<h2 id="a-heuristic-example">A heuristic example<a hidden class="anchor" aria-hidden="true" href="#a-heuristic-example">#</a></h2>
<p>If we have two assets $X_t$ and $Y_t$, and we do a linear regression
$Y_t = \beta X_t + \mu+\epsilon_t$. And we select two time points $t_1$
and $t_2$. If $\epsilon_{t_1}$ is larger than $\epsilon_{t_2}$, and we
make a subtraction of the regression function given two-time points:
</p>
$$(Y_{t_1} - Y_{t_2}) + \beta(X_{t_2} - X_{t_1}) = \epsilon_{t_1} - \epsilon_{t_2} > 0$$<p>
The right-hand side is our profit which is positive and the first part
of the left-hand side $(Y_{t_1} - Y_{t_2})$ is the short position
profit, the second part $\beta(X_{t_2} - X_{t_1})$ is the long position
profit. To conclude, the profit is positive as long as the residual for
the opening position is larger than that of the closing position.</p>
<p>In the financial market, we usually assume that the asset such as stock
price, is a random walk process:
</p>
$$X_t = X_{t-1} + \epsilon_t, \quad \epsilon_t \sim \mathcal{N}(0, \sigma^2)$$<p>
and if $Y_t$ is induced from this random walk $X_t$by:
</p>
$$Y_t = \beta X_t + \mu + q_t$$<p> We can say these two random walk
processes or in other words, these two assets $Y_t$ and $X_t$ are
cointegrated where $q_t$ can be any kind of stationary processes, such
as AR(1). And the $\beta$ defines their long-term equilibrium
relationship.</p>
<p>But this assumption is simply too strong since the coefficients $\beta$
and $\mu$ define the long-term equilibrium relationship but in reality
that might be just short-term. To solve this problem we can simply
define the coefficients are time-varying, we can assume that they are
also random walk processes:
</p>
$$\beta_t = \beta_{t-1} + \eta_{\beta,t}, \quad \eta_{\beta,t} \sim \mathcal{N}(0, \sigma_{\beta}^2)$$$$\mu_t = \mu_{t-1} + \eta_{\mu,t}, \quad \eta_{\mu,t} \sim \mathcal{N}(0, \sigma_{\mu}^2)$$<p>
And then our observation formula becomes:
</p>
$$Y_t = \beta_tX_t + \mu_t + \epsilon_t
    \label{main}$$<p> And the $\epsilon_t$ here again, should be a
stationary process or a mean reverting process which allows
heterogeneity noise level. In conclusion, our goal becomes to find a
series of $\beta_t$ and $\mu_t$ that can help us to filter out the
signal hidden in our observation. Now, the question becomes what model
we should use.</p>
<h2 id="model-requirements-model-requirements">Model requirements {#Model requirements}<a hidden class="anchor" aria-hidden="true" href="#model-requirements-model-requirements">#</a></h2>
<p>Following the previous section, we can discern that the model should be
able to decompose the signal $Y_t$ given the feature $X_t$ to a
regression part $\beta_tX_t$ and a stochastic trend part $\mu_t$, which
are latent variables. The investor should be able to know these two
values given any time $t$ and their Epistemic uncertainty.</p>
<p>To let the investor implement a hedging strategy, the model should:</p>
<ul>
<li>
<p>Gives parameter $\beta_t$ and $\mu_t$ their estimation and past
value with uncertainty quantification</p>
</li>
<li>
<p>Successfully filter out the signal hidden in $Y_t$ and get a
stationary or a mean reverting residual $\epsilon_t$</p>
</li>
</ul>
<h1 id="model-choices">Model choices<a hidden class="anchor" aria-hidden="true" href="#model-choices">#</a></h1>
<p>In order to compare our models, firstly we need to know how well the
model captures the true latent variable, which means we need to do a
simulation where the true value of latent variables given any time point
is known. So we can&rsquo;t use the real stock data since we don&rsquo;t know the
value of the latent variables. To solve this issue we use a
data-generating process from below.</p>
<h2 id="experiment-setup">Experiment setup<a hidden class="anchor" aria-hidden="true" href="#experiment-setup">#</a></h2>
<p>We will use the following data-generating process:</p>
<p>:::: algorithm
::: algorithmic
Choose sequence length $T$ Generate T random numbers array $S$ from
normal distribution $N(0, 1)$ Do $cumsum(S)$ and get the random walk
$X_t$ Generate $\beta_t$ from $1 + 0.5sin(0.5t)$,generate $\mu_t$ from
$0.2cos(0.3t)$ Generate heteroskedastic noise $\epsilon$ Generate $Y_t$
by plugging in all components $Y_t = \beta_tX_t + \mu_t + \epsilon_t$
:::
::::</p>
<h2 id="bayesian-regression">Bayesian regression<a hidden class="anchor" aria-hidden="true" href="#bayesian-regression">#</a></h2>
<p>Because the regression coefficients are fixed in the normal linear
regression model, to make its prediction time-varying we can fit the
model given a window of data. For the prior choices, we can have two
situations.</p>
<h3 id="recursive-prior">Recursive prior<a hidden class="anchor" aria-hidden="true" href="#recursive-prior">#</a></h3>
<p>If we plug in the posterior from the previous time point as a prior for
the next time point, would it be possible to preserve the information
from the past and also take new information into account?</p>
<p>:::: algorithm
::: algorithmic
Calculate the $Posterior_2$ from the initial $prior_1$ Calculate
$Posterior_t$ from $Prior_{t-1}$
:::
::::</p>
<h3 id="fixed-prior">fixed prior<a hidden class="anchor" aria-hidden="true" href="#fixed-prior">#</a></h3>
<p>For the fixed prior method we just use the initial prior every time we
calculate the posterior.</p>
<p>:::: algorithm
::: algorithmic
Calculate $Posterior_t$ from $Prior_1$
:::
::::</p>
<h3 id="simulation-result">Simulation result<a hidden class="anchor" aria-hidden="true" href="#simulation-result">#</a></h3>
<p>Because for random walk data, we really can&rsquo;t know what the trend is
going to be in the future, and also we can&rsquo;t use the historical data to
estimate the prior variance and mean since that means we use the data
twice. So eventually we have to settle using a default Gaussian
conjugate prior, which is not ideal.</p>
<figure id="recursive prior">
<div class="minipage">
<img src="BRF.png" />
</div>
<div class="minipage">
<img src="BRW_re.png" />
</div>
<figcaption>recursive prior</figcaption>
</figure>
<p>From the graph [</p>
\[fixed prior\]<p>](#fixed prior){reference-type=&ldquo;ref&rdquo;
reference=&ldquo;fixed prior&rdquo;} and [1](#recursive prior){reference-type=&ldquo;ref&rdquo;
reference=&ldquo;recursive prior&rdquo;} we discern that the recursive prior seems
to be regularized, the prior distribution keeps pulling the posterior
back to itself, to conclude we can say that a fixed prior is a better
choice for this scenario. However the fixed prior model still can&rsquo;t
capture the two time-varying components well it may due to the fact that
it only has the data inside of the window so it can&rsquo;t produce a reliable
estimation. In order to address this issue we have the following GAM
model.</p>
<h2 id="bayesian-generalized-additive-model">Bayesian generalized additive model<a hidden class="anchor" aria-hidden="true" href="#bayesian-generalized-additive-model">#</a></h2>
<p>In order to fix the problem of having a fixed regression parameter, we
can treat the two components $\beta_t$ and $\mu_t$ as a function of t
themselves. </p>
$$Y_t = \beta(t)X_t + \mu(t) + \varepsilon_t$$<p> And we can
use some desirable function forms such as a polynomial
function$\beta(t) = B(t)b$ and $\mu(t) = B(t)m$. So the new function
becomes: </p>
$$Y_t = X_t B(t)b + B(t)m + \varepsilon_t$$<p> The parameters
which we care about are the weight of the component inside of the
polynomial function, we give them a non-informative Gaussian conjugate
prior distribution. Again here we could not specify any meaningful prior
since in the market we can&rsquo;t know how the future will play out and we
don&rsquo;t want to use the data twice by estimating the prior using the
history.</p>
<figure id="Composite Gaussian Process">
<div class="minipage">
<img src="Bayesian GAM.png" />
</div>
<div class="minipage">
<img src="HGP.png" />
</div>
<figcaption>Composite Gaussian Process</figcaption>
</figure>
<p>As the graph [</p>
\[Bayesian GAM\]<p>](#Bayesian GAM){reference-type=&ldquo;ref&rdquo;
reference=&ldquo;Bayesian GAM&rdquo;} shows, the polynomial function is smooth
enough to approximate the true $\beta_t$ while didn&rsquo;t approximate well
on the true $\mu_t$. Regarding its residual, it looks stationary enough
for applying trading strategy. But this model doesn&rsquo;t try to model the
heterogeneity noise itself, can we use an ensemble method where the
model has a component that is solely used for adapting
heteroskedasticity?</p>
<h2 id="composite-gaussian-process">Composite Gaussian Process<a hidden class="anchor" aria-hidden="true" href="#composite-gaussian-process">#</a></h2>
<p>A Gaussian process is a non-parametrical model that can predict a
conditional normal distribution using all the data it stored in its
covariance function. But normally we only have a simple kernel for
calculating the covariance between the data, in my proposed method I
attempted to use a composite kernel to adapt the time-varying parameters
and heteroskedasticity. </p>
$$\begin{aligned}
Y_t &= \beta_t X_t + \mu_t + \epsilon_t \\
\theta_t &= \begin{bmatrix} \beta_t \\ \mu_t \\ \epsilon_t \end{bmatrix} \\
\theta_t &\sim \mathcal{GP} \left( 0, \begin{bmatrix} k_\beta(t, t') & 0 & 0 \\ 0 & k_\mu(t, t') & 0 \\ 0 & 0 & k_\epsilon(t, t') \end{bmatrix} \right) \\
Y_t &= \begin{bmatrix} X_t, 1, 1 \end{bmatrix} \theta_t
\label{compositeGP}
\end{aligned}$$<p> As the formula
<a href="#compositeGP">\[compositeGP\]</a>{reference-type=&ldquo;ref&rdquo;
reference=&ldquo;compositeGP&rdquo;} shows, we have a vector of parameters and they
follow a Gaussian Process, where the kernel for $\beta_t$ has to be
scaled by the observation $X_t$. We have a specific kernel for the
residual itself, so we can actually use this model to predict the
residual, we treat the residual as a &lsquo;signal&rsquo; itself and we train the
hyperparameters insides of the kernel by maximizing the marginal
likelihood. As the graph
[2](#Composite Gaussian Process){reference-type=&ldquo;ref&rdquo;
reference=&ldquo;Composite Gaussian Process&rdquo;} shows, the kernel for $\beta_t$
seems to be too expressive, it captures all the variation inside of the
data, leaving a too limited amount of room for the $\mu_t$ to explain.
The prediction of the $\epsilon_t$ component is not promising, it barely
covers the range of the data, so we still need to find a model that can
explain the heteroskedasticity well.</p>
<h2 id="bayesian-structural-time-series">Bayesian structural time series<a hidden class="anchor" aria-hidden="true" href="#bayesian-structural-time-series">#</a></h2>
<p>Bayesian structural time series is a method for a generalized
decomposition of time series. It&rsquo;s similar to of Kalman filter but has
an addition of the Bayesian theorem. In this model, we again use the
formula <a href="#main">\[main\]</a>{reference-type=&ldquo;ref&rdquo; reference=&ldquo;main&rdquo;}, but
this time we give a prior over time. As I mentioned in the introduction,
we assume the time-varying component to be also a random walk, so we can
give it a Gaussian random walk prior:
</p>
$$\beta_{t+1} | \beta_t, \sigma_\beta^2 \sim \mathcal{N}(\beta_t, \sigma_\beta^2)$$$$\mu_{t+1} | \mu_t, \sigma_\mu^2 \sim \mathcal{N}(\mu_t, \sigma_\mu^2)$$$$\sigma_\beta^2, \sigma_\mu^2 \sim \text{Half-Cauchy}(0, 1)$$<p> And the
prior for the noise level: </p>
$$\begin{subequations}
\begin{align}
\log \sigma_t &\sim \mathcal{N}(\log \sigma_{t-1}, 0.1^2) \\
\log \sigma_1 &\sim \mathcal{N}(0, 1) \\
\sigma_t &= \exp(\log \sigma_t)
\end{align}
\end{subequations}$$<p> and the likelihood function is:
</p>
$$Y_t | \beta_t, \mu_t, \sigma^2 \sim \mathcal{N}(\beta_t X_t + \mu_t, \sigma_t^2)$$<p>
And we sample the posterior using the NUT sampling from the PyMC
package.</p>
<figure id="BSTS">
<div class="minipage">
<img src="pymc_statespace_prior.png" />
</div>
<div class="minipage">
<img src="BSTS_simulation.png" />
</div>
<figcaption>BSTS</figcaption>
</figure>
<p>As you can see from the graph <a href="#BSTS">3</a>{reference-type=&ldquo;ref&rdquo;
reference=&ldquo;BSTS&rdquo;}, the model fits the $\beta_t$ component pretty well
and also gives the correct estimation for the noise level, the residual
range is covered by its noise level prediction. During the posterior
sampling, because there are too many parameters(the algorithm gives a
posterior distribution for the parameter given any time point), the
model encounters an over-parameterized problem, sometimes the algorithm
outputs the effective sample size per chain is smaller than 100 for some
parameters, which is a problem that needs to be addressed.</p>
<h2 id="model-fitting-budgets">model fitting budgets<a hidden class="anchor" aria-hidden="true" href="#model-fitting-budgets">#</a></h2>
<p>Although the more complex the model the more stationary the residual is,
their fitting budget should also be taken into consideration:</p>
<p><img alt="model fitting time" loading="lazy" src="budget.png">{#fig:enter-label width=&ldquo;50%&rdquo;}</p>
<p>Notice that the BSTS model has o(n) computation complexity. Other models
have negligible complexity levels.</p>
<h1 id="experiment">Experiment<a hidden class="anchor" aria-hidden="true" href="#experiment">#</a></h1>
<h2 id="finding-cointegrated-pairs">Finding cointegrated pairs<a hidden class="anchor" aria-hidden="true" href="#finding-cointegrated-pairs">#</a></h2>
<p>First of all, we need to find the potential cointegrated pairs by
judging their non-linear relationships. We can use the Gaussian process
to fit every single stock and extract their hyperparameter. The data
which gives a similar hyperparameter should have similar behaviour.</p>
<p>However the stock data is really long (around 2000 time points), and
it&rsquo;s too time-consuming to fit an exact GP model for all 500 stocks. In
this case, we use a method called sparse GPs and variational inference
to approximate the exact GPs. Their induced points are chosen by every
data point in every 10 steps.</p>
$$k(x, x') = \sigma_f^2 \exp\left(-\frac{(x - x')^2}{2\ell^2}\right) + \sigma_n^2 \delta(x, x')
    \label{hyper}$$<p>The Procedure would be following:</p>
<p>:::: algorithm
::: algorithmic
choose what hyperparameters to use from the kernel
function<a href="#hyper">\[hyper\]</a>{reference-type=&ldquo;ref&rdquo; reference=&ldquo;hyper&rdquo;}. Fit
all stocks from Sp500 and save their hyperparameters Do K-means
clustering by $C$ number of clusters
:::
::::</p>
<p>The full clustering result will be shown in the appendix. Here I choose
a cluster where there are only 3 stocks:</p>
<p><img alt="Clustering result" loading="lazy" src="cluster_stocks.png">{#cluster_stocks width=&ldquo;100%&rdquo;}</p>
<p>As the graphs show, we can recognize they have similar trends and
volatility. What&rsquo;s surprising is that these three stocks are all from
the utility sector. And then we would test the pair of &lsquo;NI&rsquo; and &lsquo;PPL&rsquo;
and see if the models satisfy the model requirements in the section
[1.2](#Model requirements){reference-type=&ldquo;ref&rdquo;
reference=&ldquo;Model requirements&rdquo;}.</p>
<h2 id="real-world-data-experiments">Real world data experiments<a hidden class="anchor" aria-hidden="true" href="#real-world-data-experiments">#</a></h2>
<figure id="GAM1">
<div class="minipage">
<img src="br.png" />
</div>
<div class="minipage">
<img src="GAM.png" />
</div>
<figcaption>Bayesian Gam</figcaption>
</figure>
<figure id="BSTS1">
<div class="minipage">
<img src="CGP.png" />
</div>
<div class="minipage">
<img src="BSTS.png" />
</div>
<figcaption>BSTS model</figcaption>
</figure>
<p>For Bayesian regression in graph <a href="#BR1">\[BR1\]</a>{reference-type=&ldquo;ref&rdquo;
reference=&ldquo;BR1&rdquo;}, the residual does have a certain level of mean
reverting behaviour but seems to have small trending behaviour from time
to time. The decomposition result of the GAM model
<a href="#GAM1">6</a>{reference-type=&ldquo;ref&rdquo; reference=&ldquo;GAM1&rdquo;} seems to be the
counterpart of the Bayesian regression model, but that&rsquo;s expected
behaviour since the time-varying function can have multiple solutions.
And the fluctuation of residual is smaller comparatively.</p>
<p>The decomposition from GPs <a href="#CGP1">\[CGP1\]</a>{reference-type=&ldquo;ref&rdquo;
reference=&ldquo;CGP1&rdquo;} behaves differently from the other three algorithms
and notice that the Epsilon part is a prediction, not the real residual,
so by using composite GPs we can have a prediction of the range of
residual. (but here might be improved by restricting it to have zero
means, so that all other variations of the data would be captured by the
other two components).</p>
<p>The residual of BSTS model <a href="#BSTS1">7</a>{reference-type=&ldquo;ref&rdquo;
reference=&ldquo;BSTS1&rdquo;} looks the most stationary, but it seems that the
fluctuation is too small to generate profit, the model is overfitting to
the degree that the time series is decomposed &rsquo;too well&rsquo;, and the
residual becomes tiny, so it&rsquo;s hard to generate high profit with this
residual, but if you have low trading fee it would possibly still work
since the trading frequency is really high.</p>
<p>In conclusion, Whether a model is good for developing a trading strategy
depends on how the residual of the model behaves. It&rsquo;s a bargain between</p>
<ul>
<li>
<p>Big residual, low frequency mean reverting and</p>
</li>
<li>
<p>small residual but high frequency mean reverting.</p>
</li>
</ul>
<p>In the real-world scenario, choosing which kind of model depends on the
trading fee and the latency of the server.</p>
<h1 id="future-works">future works<a hidden class="anchor" aria-hidden="true" href="#future-works">#</a></h1>
<p>We need to address the issue of the sample size not being enough
effective in the BSTS model. We also need to find out how to speed up
the sampling process for backtesting. For the composite Gaussian process
we still need to figure out how to restrict the expressiveness $\beta_t$
kernel to have a balance between the two time-varying components
regarding their variations. The goal is the have a model stable
estimation. Also, we definitely have to try out other online updating
methods instead of giving a fixed window to the model. We can use the
Woodbury formula to update the covariance function. Also to improve the
trustworthiness of the model we can incorporate an ADF test after
fitting the model in order to tell if two assets truly have a
cointegration relationship.</p>
<h1 id="appendix">appendix<a hidden class="anchor" aria-hidden="true" href="#appendix">#</a></h1>
<h2 id="clustering-result">Clustering result<a hidden class="anchor" aria-hidden="true" href="#clustering-result">#</a></h2>
<p><img alt="Clusters" loading="lazy" src="clustering.png">{#Clusters width=&ldquo;100%&rdquo;}</p>
<h2 id="backtesting-result">Backtesting result<a hidden class="anchor" aria-hidden="true" href="#backtesting-result">#</a></h2>
<p>The performance metrics and the backtest results are calculated using
the following steps and frameworks:</p>
<h3 id="trading-strategy-flow-chart-and-the-backtest-framework">Trading strategy flow chart and the backtest framework<a hidden class="anchor" aria-hidden="true" href="#trading-strategy-flow-chart-and-the-backtest-framework">#</a></h3>
<p><img alt="Strategy flow chart" loading="lazy" src="img_3.png">{#fig:enter-label width=&ldquo;75%&rdquo;}</p>
<p><img alt="Backtesting framework" loading="lazy" src="img_2.png">{#fig:enter-label width=&ldquo;100%&rdquo;}</p>
<p>For all pairs in the cluster 1 from the table
<a href="#Clusters">8</a>{reference-type=&ldquo;ref&rdquo; reference=&ldquo;Clusters&rdquo;}:</p>
<figure>
<div class="minipage">
<img src="img_6.png" />
</div>
<div class="minipage">
<img src="img_7.png" />
</div>
<figcaption>Bayesian Gam</figcaption>
</figure>
<p>For all pairs in the cluster 24 from the table
<a href="#Clusters">8</a>{reference-type=&ldquo;ref&rdquo; reference=&ldquo;Clusters&rdquo;}:</p>
<figure>
<div class="minipage">
<img src="img_8.png" />
</div>
<div class="minipage">
<img src="img_9.png" />
</div>
<figcaption>Bayesian Gam</figcaption>
</figure>
<p>And the financial metrics comparison:</p>
<p>Metric                   Model    Min      Q25     Median    Q75      Max</p>
<hr>
<p>Cumulative Return         BR     -0.338   -0.033   0.003    0.037    0.149
GAM    -0.406   -0.045   -0.003   0.034    0.197
GPS    -0.334   -0.043   0.001    0.030    0.163
Annualized Volatility     BR     0.013    0.016    0.018    0.024    0.061
GAM    0.008    0.014    0.017    0.021    0.056
GPS    0.008    0.014    0.016    0.020    0.053
Sharpe Ratio              BR     -0.455   -0.125   0.021    0.160    0.618
GAM    -0.770   -0.179   -0.008   0.170    0.819
GPS    -0.778   -0.182   0.015    0.157    0.763
Max Drawdown              BR     -0.382   -0.093   -0.062   -0.043   -0.027
GAM    -0.438   -0.095   -0.063   -0.049   -0.023
GPS    -0.414   -0.091   -0.062   -0.046   -0.019</p>
<p>: Model comparison Cluster1</p>
<p>Metric                   Model    Min      Q25     Median    Q75      Max</p>
<hr>
<p>Cumulative Return         BR     -0.455   -0.025   -0.003   0.038    0.092
GAM    -0.290   -0.048   -0.011   0.036    0.188
GPs    -0.157   -0.048   -0.012   0.022    0.250
Annualized Volatility     BR     0.008    0.014    0.016    0.021    0.071
GAM    0.005    0.013    0.016    0.019    0.057
GPs    0.007    0.013    0.016    0.018    0.033
Sharpe Ratio              BR     -0.634   -0.117   -0.004   0.203    0.658
GAM    -0.783   -0.217   -0.051   0.223    1.119
GPs    -0.767   -0.230   -0.052   0.124    0.867
Max Drawdown              BR     -0.480   -0.085   -0.060   -0.047   -0.020
GAM    -0.403   -0.090   -0.066   -0.042   -0.020
GPs    -0.219   -0.089   -0.067   -0.046   -0.021</p>
<p>: Model comparison cluster2</p>
<h2 id="regime-changed-detection">Regime changed detection<a hidden class="anchor" aria-hidden="true" href="#regime-changed-detection">#</a></h2>
<p>Previously, we were doing experiment assuming that the time-varying
component has a continuously changing behaviour, but how about discrete
changing behaviour, how well will our models react to this situation?
Again we use the formula from the introduction
<a href="#main">\[main\]</a>{reference-type=&ldquo;ref&rdquo; reference=&ldquo;main&rdquo;}, and we assume
that the two assets have three regimes:</p>
<p><img alt="regime relationships" loading="lazy" src="regime_relationships.png">{#fig:enter-label
width=&ldquo;100%&rdquo;}</p>
<p>We use these three regimes to generate a time series by random choices
of the regimes:</p>
<p><img alt="regime simulation" loading="lazy" src="regime_simulation.png">{#fig:enter-label
width=&ldquo;75%&rdquo;}</p>
<p>We fit our four models to this time series:</p>
<figure>
<div class="minipage">
<img src="br2.png" />
</div>
<div class="minipage">
<img src="gam2.png" />
</div>
<figcaption>Bayesian Gam</figcaption>
</figure>
<figure>
<div class="minipage">
<img src="HGP2.png" />
</div>
<div class="minipage">
<img src="BSTS2.png" />
</div>
<figcaption>Bayesian Gam</figcaption>
</figure>
<p>It seems that simple models such as rolling window regression and GAM
couldn&rsquo;t capture the discontinued time-varying states well. In this
case, the BSTS model works the best.</p>
<h2 id="code">code<a hidden class="anchor" aria-hidden="true" href="#code">#</a></h2>
<p>All the related code of this project is uploaded in</p>
<p><a href="https://github.com/Oldhuntor/QuantResearch/tree/main">https://github.com/Oldhuntor/QuantResearch/tree/main</a></p>
<p>The names of the files of the four models are:</p>
<p><strong>bayesian_regression.py</strong></p>
<p><strong>BSTS.py</strong></p>
<p><strong>jointCov2.py</strong></p>
<p><strong>BayesGAM.py</strong> which are inside of the <strong>model_new</strong> folder. The
simulation results are generated from the code file <strong>models.py</strong> in the
<strong>slides</strong> folder.The real-world data experiment results are generated
from the file named <strong>clustering_result_analysis.py</strong> in the folder of
<strong>model_new]bayesian_clustering]</strong>.</p>
<h2 id="acknowledgement">Acknowledgement<a hidden class="anchor" aria-hidden="true" href="#acknowledgement">#</a></h2>
<p>The trading strategy is inspired by the paper:
@zhang2020pairstradingnonlinearnongaussian.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Cointegration Pairs Trading on x"
            href="https://x.com/intent/tweet/?text=Cointegration%20Pairs%20Trading&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fexample5%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Cointegration Pairs Trading on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fexample5%2f&amp;title=Cointegration%20Pairs%20Trading&amp;summary=Cointegration%20Pairs%20Trading&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fexample5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Cointegration Pairs Trading on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fexample5%2f&title=Cointegration%20Pairs%20Trading">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Cointegration Pairs Trading on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fexample5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Cointegration Pairs Trading on whatsapp"
            href="https://api.whatsapp.com/send?text=Cointegration%20Pairs%20Trading%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fexample5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Cointegration Pairs Trading on telegram"
            href="https://telegram.me/share/url?text=Cointegration%20Pairs%20Trading&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fexample5%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Cointegration Pairs Trading on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Cointegration%20Pairs%20Trading&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fexample5%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Xuanhao&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
